<div class='thumbnail'>
	<% if img = Resource.find(index.key_resource_id) rescue nil -%>
		<% if img.image? || img.pdf? -%>
			<% link_to(image_path(img.public_filename(:lightview)), {:class =>'lightview', :rel => 'set[myset]', 
						:id => "#{index.class.to_s}_#{index.id}", :title => "#{index.name} :: #{index.description} #{link_to 'More Detail', url_for(index)}"}) do -%>
        <%= image_tag(img.public_filename(:thumb), { :id => "gallery_image_#{index.id}"}) %>
				<%= image_tag 'zoom.png', { :class=>'thumbnail_overlay'} %>
			<% end -%>
		<% elsif img.has_slideshare -%>
			<% link_to img.url, { :class=>'lightview', :rel => 'set[myset]', :id => "#{index.class.to_s}_#{index.id}", 
					:title => "#{index.name} :: #{index.description}"} do -%>
  			<%= image_tag 'zoom.png', { :class=>'thumbnail_overlay'} %>
        <%= image_tag('slideshare_200x50.png') %>
      <% end -%> 
		<% end -%>
	<% else #if !img.blank? # not an image...probably slideshare-%>
		<% link_to url_for(:action=>'show', :controller => index.class.to_s.tableize, :id=>index.id, :ignore_layout=>true),
				{:class => 'lightview', :rel => 'set[myset]', :id => "#{index.class.to_s}_#{index.id}",
				 	:title => "#{index.name} :: #{index.description}"} do -%>
          <%#= image_tag '/images/no_image.png', { :id => "gallery_image_#{index.id}", :class => 'gallery_image' } %>
    <% end -%>
	<% end -%>
  <canvas id='gallery_image<%=index.id%>' src="/images/no_image.png" class='gallery_image'> </canvas>
	<span class='gallery_tags'>
      <%=index.tag_list.collect{ |dt| (dt==index.tag_list.first ? "":", ") + link_to_function(dt, "toggleGalleryImgsByTag('#{dt}', '#{divname}')", :class => "#{dt.tr(' -', '_')} tag") } %>
	</span>
</div>