var RungeKuttaIntegrator=function(b,a){this.initialize(b,a)};RungeKuttaIntegrator.prototype={initialize:function(b,a){this.particleModel=b;this.particles=b.particles;this.view=a;this.setSize(a.frameWidth,a.frameHeight,a.skew);this.k1ForcesX=new Array();this.k2ForcesX=new Array();this.k3ForcesX=new Array();this.k4ForcesX=new Array();this.k1ForcesY=new Array();this.k2ForcesY=new Array();this.k3ForcesY=new Array();this.k4ForcesY=new Array();this.k1VelocitiesX=new Array();this.k2VelocitiesX=new Array();this.k3VelocitiesX=new Array();this.k4VelocitiesX=new Array();this.k1VelocitiesY=new Array();this.k2VelocitiesY=new Array();this.k3VelocitiesY=new Array();this.k4VelocitiesY=new Array()},setSize:function(a,c,b){this.boundsLeft=(-a/2)/b;this.boundsRight=(a/2)/b;this.boundsTop=-c/2;this.boundsBottom=c/2},allocateParticle:function(a){this.k1ForcesX[a]=0;this.k2ForcesX[a]=0;this.k3ForcesX[a]=0;this.k4ForcesX[a]=0;this.k1ForcesY[a]=0;this.k2ForcesY[a]=0;this.k3ForcesY[a]=0;this.k4ForcesY[a]=0;this.k1VelocitiesX[a]=0;this.k2VelocitiesX[a]=0;this.k3VelocitiesX[a]=0;this.k4VelocitiesX[a]=0;this.k1VelocitiesY[a]=0;this.k2VelocitiesY[a]=0;this.k3VelocitiesY[a]=0;this.k4VelocitiesY[a]=0},step:function(){var s=this.particles;var j=this.k1ForcesX;var r=this.k2ForcesX;var b=this.k3ForcesX;var q=this.k4ForcesX;var h=this.k1ForcesY;var p=this.k2ForcesY;var a=this.k3ForcesY;var m=this.k4ForcesY;var d=this.k1VelocitiesX;var f=this.k2VelocitiesX;var o=this.k3VelocitiesX;var u=this.k4VelocitiesX;var c=this.k1VelocitiesY;var e=this.k2VelocitiesY;var k=this.k3VelocitiesY;var t=this.k4VelocitiesY;for(var n=0,g=s.length;n<g;n++){if(!s[n].fixed&&!s[n].selected){s[n].originalPositionX=s[n].positionX;s[n].originalPositionY=s[n].positionY;s[n].originalVelocityX=s[n].velocityX/2;s[n].originalVelocityY=s[n].velocityY/2}}this.particleModel.applyForces();for(var n=0,g=s.length;n<g;n++){if(!s[n].fixed&&!s[n].selected){j[n]=s[n].forceX;h[n]=s[n].forceY;d[n]=s[n].velocityX;c[n]=s[n].velocityY}}for(var n=0,g=s.length;n<g;n++){if(!s[n].fixed&&!s[n].selected){s[n].positionX=s[n].originalPositionX+d[n]*0.5;s[n].positionY=s[n].originalPositionY+c[n]*0.5;s[n].velocityX=s[n].originalVelocityX+(j[n]*0.5)/s[n].mass;s[n].velocityY=s[n].originalVelocityY+(h[n]*0.5)/s[n].mass}}this.particleModel.applyForces();for(var n=0,g=s.length;n<g;n++){if(!s[n].fixed&&!s[n].selected){r[n]=s[n].forceX;p[n]=s[n].forceY;f[n]=s[n].velocityX;e[n]=s[n].velocityY}}for(var n=0,g=s.length;n<g;n++){if(!s[n].fixed&&!s[n].selected){s[n].positionX=s[n].originalPositionX+f[n]*0.5;s[n].positionY=s[n].originalPositionY+e[n]*0.5;s[n].velocityX=s[n].originalVelocityX+(r[n]*0.5)/s[n].mass;s[n].velocityY=s[n].originalVelocityY+(p[n]*0.5)/s[n].mass}}this.particleModel.applyForces();for(var n=0,g=s.length;n<g;n++){if(!s[n].fixed&&!s[n].selected){b[n]=s[n].forceX;a[n]=s[n].forceY;o[n]=s[n].velocityX;k[n]=s[n].velocityY}}for(var n=0,g=s.length;n<g;n++){if(!s[n].fixed&&!s[n].selected){s[n].positionX=s[n].originalPositionX+o[n];s[n].positionY=s[n].originalPositionY+k[n];s[n].velocityX=s[n].originalVelocityX+(b[n])/s[n].mass;s[n].velocityY=s[n].originalVelocityY+(a[n])/s[n].mass}}this.particleModel.applyForces();for(var n=0,g=s.length;n<g;n++){if(!s[n].fixed&&!s[n].selected){q[n]=s[n].forceX;m[n]=s[n].forceY;u[n]=s[n].velocityX;t[n]=s[n].velocityY}}for(var n=0,g=s.length;n<g;n++){if(!s[n].fixed&&!s[n].selected){s[n].positionX=s[n].originalPositionX+(1/6)*(d[n]+2*f[n]+2*o[n]+u[n]);s[n].positionY=s[n].originalPositionY+(1/6)*(c[n]+2*e[n]+2*k[n]+t[n]);s[n].velocityX=s[n].originalVelocityX+(1/(6*s[n].mass))*(j[n]+2*r[n]+2*b[n]+q[n]);s[n].velocityY=s[n].originalVelocityY+(1/(6*s[n].mass))*(h[n]+2*p[n]+2*a[n]+m[n])}}}};