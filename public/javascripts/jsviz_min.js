var jsvizObj;function jsviz_init(){var c=window.location.href.indexOf("TIMEDBUILD")>0?true:false;this.divLocation=$("jsviz_div");var g=this.divLocation.up();if(g){this.divLocation.style.width=g.getWidth()+"px"}var f=!(navigator.userAgent.indexOf("MSIE")>-1);this.layout=new ForceDirectedLayout(this.divLocation,f);var d=this.layout;d.view.skewBase=575;d.setSize();d.config._default={model:function(h){return{mass:0.5}},view:function(j,k){if(d.svg){var l=document.createElementNS("http://www.w3.org/2000/svg","g");var n=document.createElementNS("http://www.w3.org/2000/svg","circle");n.setAttribute("stroke","#888888");n.setAttribute("stroke-width",".25px");n.setAttribute("fill",j.color);n.setAttribute("r",6+"px");n.onmouseover=new EventHandler(d,function(r,v,x,w,t,q){document.body.style.cursor="pointer";var u=document.getElementById("tooltip");var o=document.getElementById("jsviz_div");var s=o.positionedOffset();var p="";if(r.parent){r.parent.each(function(y){p+=", "+y.URL})}u.innerHTML="URL: "+r.URL+" , # parents: "+p;u.style.display="block";u.style.left=(v.positionX*x+t+s.left+5)+"px";u.style.top=(v.positionY*w+q+s.top-25)+"px";d.mouseHover=true},j,k,d.view.skewX,d.view.skewY,d.view.centerX,d.view.centerY);n.onmouseout=new EventHandler(d,function(){document.getElementById("tooltip").style.display="none";d.mouseHover=false;document.body.style.cursor="default"});n.onmousedown=new EventHandler(d,function(q,p,o){d.handleMouseDownEvent(q)},k.id,n);n.onmouseup=new EventHandler(d,function(p,o){d.handleMouseUpEvent();Event.stop(o)},n);if(!j.cannot_undo){n.onclick=new EventHandler(d,function(o,r,p){Event.stop(p);if(d.mouseMoved){d.mouseMoved=false;Event.stop(p);return false}if(o.isAjax){var q="";new Ajax.Updater("p_page",o.URL,{asynchronous:true,evalScripts:true,method:"get",parameters:q,onLoading:function(){$("spinner_div").show()},onComplete:function(){$("spinner_div").hide();if($("entire_gallery")){Lightview.updateViews();loadSpotLights()}updateCurrMenuItem("menu_"+o.controller);window.document.fire("jsviz:clicked")}})}else{if(o.cannotUndo){}else{window.location=o.URL}}},j,n)}l.appendChild(n);if(j.text&&j.text!=""){var i=document.createElementNS("http://www.w3.org/2000/svg","text");var m=document.createTextNode(j.text);i.setAttribute("text-anchor","middle");i.setAttribute("x","0px");i.setAttribute("y","18px");i.appendChild(m);l.appendChild(i)}if(j.root){l.setAttribute("id","RootNode")}else{l.setAttribute("id",j.id)}return l}else{var n=document.createElement("div");n.style.position="absolute";n.style.width="12px";n.style.height="12px";var h=j.color.replace("#","");n.style.backgroundImage="url(http://kylescholz.com/cgi-bin/bubble.pl?title=&r=12&pt=8&b=888888&c="+h+")";n.innerHTML='<img width="1" height="1">';n.onmouseover=new EventHandler(window,function(p,r,q,o,u,t){var s=document.getElementById("tooltip");s.innerHTML="URL: "+p.URL+" isAjax: "+p.isAjax+" isCurr: "+p.current;s.style.display="block";s.style.left=(r.positionX*q+u+5)+"px";s.style.top=(r.positionY*o+t+35)+"px"},j,k,d.view.skewX,d.view.skewY,d.view.centerX,d.view.centerY);n.onmouseout=new EventHandler(window,function(){document.getElementById("tooltip").style.display="none"});n.onmousedown=new EventHandler(d,d.handleMouseDownEvent,k.id);n.onmouseup=new EventHandler(d,function(o,p){Event.stop(p);if(d.mouseMoved){d.mouseMoved=false;return}if(o.isAjax){var q="authenticity_token="+AUTH_TOKEN;new Ajax.Updater("p_page",o.URL,{asynchronous:true,evalScripts:true,parameters:q})}else{if(o.cannotUndo){}else{window.location=o.URL}}},j);return n}}};d.forces.spring._default=function(k,j,h){var i=50+Math.floor(Math.random()*5)*10;if(h){return{springConstant:0.25,dampingConstant:0.1,restLength:i}}else{return{springConstant:0.3,dampingConstant:0.28,restLength:i-20}}};d.forces.spring.A={};d.forces.spring.A["B"]=function(k,j,h){var i=50+Math.floor(Math.random()*5)*10;return{springConstant:0.5,dampingConstant:0.2,restLength:i}};d.forces.magnet=function(){return{magnetConstant:-5000,minimumDistance:70}};d.viewEdgeBuilder=function(i,h){if(this.svg){return{stroke:h.color,"stroke-width":"2px","stroke-dasharray":"2,4"}}else{return{pixelColor:h.color,pixelWidth:"2px",pixelHeight:"2px",pixels:8}}};this.loader=new JSONTreeLoader(d);this.loader.load();var a=this.loader;if(c){var e=new Timer(0);e.subscribe(d);e.start()}else{var b=function(){this.started=false;this.update=function(){var h=d.dequeueNode();if(!this.started&&h){this.started=true;while(d.dequeueNode()){}while(d.dequeueRelationship()){}}if(this.started&&!h){return false}}};this.buildTimer=new Timer(0);this.buildTimer.subscribe(new b);this.buildTimer.start()}}Event.observe(document,"lightview:loaded",function(a){$("jsviz_div").observe("click",function(b){Event.stop(b)});if(typeof(window.jsvizObj)=="undefined"){window.jsvizObj=new jsviz_init();window.jsviz_loading=false}$("jsviz_div").observe("mouseover",function(b){Event.stop(b)});Event.observe(document,"jsviz:clicked",function(b){if(!jsviz_loading){window.jsviz_loading=true;window.jsvizObj.loader.load();window.jsvizObj.buildTimer.start();window.jsviz_loading=false}})});