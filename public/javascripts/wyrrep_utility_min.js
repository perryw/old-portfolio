Lightview.moveWindow=function(){var a=document.viewport.getWidth();var c=$("lightview").getWidth();var e=77;var d=25;var g=a-c/2-d;var b=2*(a-g);var f=a-b;new Effect.Parallel([new Effect.Morph("lightview",{sync:true,style:{left:Math.round((1-g/a)*100)+"%"}}),new Effect.Morph("lv_overlay",{sync:true,style:{width:b+"px"}}),new Effect.Morph("lightviewController",{sync:true,style:{left:Math.round((1-g/a)*100)+"%"}})],{duration:0.8,delay:0.5});Lightview.restoreCenterBackup=Lightview.restoreCenter;Lightview.restoreCenter=function(){}};Lightview.changedPicture=function(a){var b=a.target.identify();new Ajax.Updater("canvas_content","/gallery/"+b,{asynchronous:true,evalScripts:true,method:"get",parameters:"authenticity_token="+AUTH_TOKEN,insertion:"top",asynchronous:false});return false};Lightview.observeCloseButtonUnbound=function(a){$("entire_gallery").show();document.fire("jsviz:clicked");return false};Lightview.observePrevNextUnbound=function(a){var b=a.target;b=(b==null)?null:b.href;if(b!=null){Lightview.detachPerryEvents();Lightview.changedPicture(b);Lightview.attachPerryEvents()}return false};Lightview.observeClicksUnbound=function(a){if(!AUTH_TOKEN){if(console.error){console.error("no authenticity token set!")}}var b=a.target;b=(b==null)?null:b.href;if(b!=null){Lightview.detachPerryEvents();Lightview.changedPicture(a);Lightview.attachPerryEvents()}return false};Lightview.attachPerryEvents=function(){document.observe("lightview:opened",Lightview.observeClicks);document.observe("lightview:hidden",Lightview.observeCloseButton)};Lightview.detachPerryEvents=function(){document.stopObserving("lightview:opened",Lightview.observeClicks);document.stopObserving("lightview:hidden",Lightview.observeCloseButton)};Lightview.observeClicks=Lightview.observeClicksUnbound.bindAsEventListener(Lightview);Lightview.observePrevNext=Lightview.observePrevNextUnbound.bindAsEventListener(Lightview);Lightview.observeCloseButton=Lightview.observeCloseButtonUnbound.bindAsEventListener(Lightview);Lightview.notObserved=true;Event.observe(document,"dom:loaded",function(){Lightview.attachPerryEvents()});checkHashName=function(){if(window.location.hash!=window.currentHash){var b=window.location.hash.sub("#","");var a=b.toLowerCase();if(!window.cache){window.cache=new Hash()}if(window.cache[a]){$("p_page").update(window.cache[a])}new Ajax.Request("/"+a,{asynchronous:true,evalScripts:true,method:"get",onComplete:function(c){$("spinner_div").hide();if(c.reponseText!=$("p_page").innerHTML){$("p_page").update(c.responseText)}updateCurrMenuItem("menu_"+a,c.responseText);loadSpotLights();document.fire("jsviz:clicked")},onFailure:function(c){if(console.error){console.error("failed to load "+a+". please refresh")}},onLoading:function(c){if(!window[b]){$("spinner_div").show()}},parameters:"authenticity_token="+encodeURIComponent("95f49415b042b6d94cc517d4fdb15a47d4f73b55")});window.currentHash=window.location.hash}return false};Event.observe(window,"load",function(){window.currentHash="";window.checkHashNameInterval=new PeriodicalExecuter(checkHashName,0.5)});updateCurrMenuItem=function(b,a){var d=$$(".current");if(d.size()){d[0].removeClassName("current")}var c=$(b).ancestors()[0];if(c){c.addClassName("current");if(a){if(!window.cache){window.cache=new Hash()}window.cache[$(b).name]=a}if(window.location.pathname=="/"){window.location.hash=$(b).name;window.currentHash=window.location.hash}}else{if(console.error){console.error("error, could not find element with id="+b)}}return false};toggleGalleryImgsByTag=function(c,h){var a=$(h);var b=a.select(".thumbnail");var g=a.select("."+c);var d=$("tag_cloud");var f=d.select("."+c);if(!g.length&&!f.length){return}g.invoke("toggleClassName","highlight");f.invoke("toggleClassName","highlight");if(!d.select(".highlight").length){b.invoke("appear");return}var e=d.select(".highlight").collect(function(i){return $w(i.className)}).flatten().without("tag","highlight","css1","css2","css3","css4","css5");b.each(function(j){var i=j.select(".gallery_tags .tag").collect(function(m){return $w(m.className)}).flatten().without("tag","highlight");var l=i.concat(e).uniq();var k=i.length+e.length;if(l.length==k){if(j.visible()){j.fade()}}else{if(!j.visible()){j.appear()}}})};toggleDivByTag=function(g,f,e){var b=$(g+f);b.appear();$("more_info_"+f).innerHTML="less info";var d=$("project_"+f+"_deliverables_tags").select("."+e);var a=false;if(d&&d.first()){a=d.first().hasClassName("highlight")}else{if(console.error){console.error("moveTo: don't know what to do with tag '"+e+"'")}return false}var c=$("project_"+f+"_deliverables_tags").select(".highlight").length;b.select(".courses_list_project_deliverable").each(function(i){var h=i.select("."+e);var j=i.select(".highlight");if(j.length>1){}else{if(j.length&&!h.length){}else{if(c<2&&a){i.appear()}else{if(h.length&&a){i.fade()}else{if(h.length){i.appear()}else{i.fade()}}}}}});$$("."+e).invoke("toggleClassName","highlight");return false};toggleInfoLink=function(a,b,c){Effect.toggle(a+b,"appear",{});$(c).innerHTML=($(c).innerHTML=="more info")?"less info":"more info"};copyGalleryTagClouds=function(){var a=$("tag_cloud");if(a){a.innerHTML=""}var b=new Element("a",{"class":"smaller",href:Element.childElements($$(".current")[0]).href,onclick:"$('tag_cloud').select('.highlight').invoke('toggleClassName','highlight'); return false;"}).update("select none");a.insert(b,{position:top});if($("gallery_projects_tag_cloud")){var c=Element.extend($("gallery_projects_tag_cloud").cloneNode(true));if(!c){if(console.error){console.error("ERROR: pCloud is null")}}c.id="gallery_projects_tag_cloud_sidebar";Element.show(c);Event.observe(c,"mouseover",function(){$("tag_cloud").morph("height:"+$("gallery_projects_tag_cloud_sidebar").getHeight()+"px");return false});Event.observe(c,"mouseout",function(){if($("tag_cloud").select(".highlight").length){return false}$("tag_cloud").morph("height:150px");return false});Element.insert(a,c)}if($("gallery_deliverables_tag_cloud")){var d=$("gallery_deliverables_tag_cloud").cloneNode(true);d.id="gallery_deliverables_tag_cloud_sidebar";if(!$("gallery_projects_tag_cloud")){Element.show(d);Event.observe(d,"mouseover",function(){$("tag_cloud").morph("height:"+$("gallery_deliverables_tag_cloud_sidebar").getHeight()+"px");return false});Event.observe(d,"mouseout",function(){if($("tag_cloud").select(".highlight").length){return false}$("tag_cloud").morph("height:150px;");return false})}Element.insert(a,d)}Effect.Appear(a);window.galleryObserver=setInterval("checkGalleryExists()",1000)};checkGalleryExists=function(){if(!$("entire_gallery")){$("tag_cloud").fade();clearInterval(window.galleryObserver)}return false};toggle_gallery_cloud=function(a){$("tag_cloud").show();Effect.toggle(a+"_tag_cloud_sidebar","appear");if(!$$(".toggle_gallery").inject(false,function(b,c){return b|c.hasClassName("highlight")})){$("tag_cloud").fade()}return false};loadSpotLights=function(){Event.stopObserving(window,"load",loadSpotLights);copyGalleryTagClouds();$("loading").update("Drawing thumbnails...");var a=$$(".gallery_image");if(a[0].getContext){$$(".gallery_image").each(function(b){new SpotLight(b)})}else{$$(".gallery_background").each(function(b){b.observe("click",function(c){window.location=Event.element(c).link_to});b.observe("mouseover",function(){document.body.style.cursor="pointer"});b.observe("mouseout",function(){document.body.style.cursor="default"})})}$("loading").update("")};var SpotLight=Class.create({initialize:function(c){this.isWebKit=navigator.userAgent.toLowerCase().indexOf("webkit")>-1;if(c.tagName=="IMG"){var a=new Element("canvas",{id:c.id});c.parentNode.replaceChild(a,c);this.canvas=a}else{this.canvas=c}var d=c.getAttribute("src");if(d){this.imgSrc=(d.indexOf("?")==-1)?d:d.substr(0,d.indexOf("?"))}else{this.imgSrc=null}this.overlayURL=c.getAttribute("overlay");this.context=this.canvas.getContext("2d");this.radius=45;this.gradient=this.context.createRadialGradient(0,0,0,0,0,this.radius);this.gradient.addColorStop(0,"rgba(255,255,255,0.3)");this.gradient.addColorStop(0.1,"rgba(255,255,255,0.3)");this.gradient.addColorStop(0.9,"rgba(255,255,255,0.1)");this.gradient.addColorStop(1,"rgba(255,255,255,0)");this.old_x=0;this.old_y=0;var b=this;var a=this.canvas;a.stopObserving("mouseover");a.observe("mouseover",function(e){e.stop();if(this.inter){clearInterval(this.inter)}if(this.mo_inter){clearInterval(this.mo_inter)}if(this.mo_to){clearTimeout(this.mo_to)}this.context.globalAlpha=1;var f=e.target.viewportOffset();this.old_x=e.clientX-f.left-8;this.old_y=e.clientY-f.top-16;this.startTime=new Date();this.hoverTimeout=setTimeout(function(){if(this.iris_inter){clearInterval(this.iris_inter)}this.iris=this.radius;this.iris_inter=setInterval(function(){this.irisIn()}.bind(this),80);return true}.bind(this),700)}.bindAsEventListener(this));a.stopObserving("mousemove");a.observe("mousemove",function(e){if(this.startTime){this.startTime=null}if(this.iris_inter){clearInterval(this.iris_inter)}var f=e.target.viewportOffset();this.x=e.clientX-f.left-8;this.y=e.clientY-f.top-16;this.move()}.bindAsEventListener(this));a.stopObserving("mouseout");a.observe("mouseout",function(){if(this.startTime){this.startTime=null}if(this.iris_inter){clearInterval(this.iris_inter)}if(this.hoverTimeout){clearInterval(this.hoverTimeout)}this.x=null;this.y=null;if(this.inter){clearInterval(this.inter)}if(this.mo_to){clearTimeout(this.mo_to)}this.iris=this.radius;this.iris_inter=setInterval(function(){this.irisIn()}.bind(this),30)}.bindAsEventListener(this));a.observe("gallery:irisIn",function(){if(this.mo_to){clearTimeout(this.mo_to)}if(this.x||this.y){return}this.mo_to=setTimeout(function(){if(this.mo_inter){clearInterval(this.mo_inter)}this.mo_inter=setInterval(function(){this.fadeOut(this.mo_inter)}.bind(this),100)}.bind(this),500)}.bindAsEventListener(this));a.stopObserving("click");a.observe("click",function(){if(this.startTime){this.startTime=null}if(this.iris_inter){clearInterval(this.iris_inter)}Lightview.show(this.canvas.up().siblings()[0])}.bindAsEventListener(this));this.initializeImages();this.inter=setInterval(function(){this.fadeOut(this.inter)}.bind(this),100)},irisIn:function(){this.iris+=5;this.drawImage(this.iris);if(this.iris>=(this.hypotenuse)){this.iris=this.radius;clearInterval(this.iris_inter);this.canvas.fire("gallery:irisIn")}return true},fadeOut:function(b){var a=this.context;if(a.globalAlpha>0.1){a.globalAlpha-=0.1;a.globalCompositeOperation="copy";a.fillStyle="rgba(0,0,0,0)";a.fillRect(0,0,this.canvas.width,this.canvas.height);if(this.ischrome){a.clearRect(0,0,this.canvas.width,this.canvas.height)}if(!this.overlayImg||!this.overlayImg.src||this.overlayImg.src==""){if(console.log){console.warn("overlayimg not properly loaded")}return}try{if(this.overlayImg.complete){a.drawImage(this.overlayImg,0,0)}}catch(c){if(console.error){console.error("error with fadeOut on "+this.overlayImg.src+" , GA>0.1: "+c.name+" "+c.message)}}}else{a.save();if(this.isWebKit){a.clearRect(0,0,this.canvas.width,this.canvas.height)}else{a.globalAlpha=0.06;try{if(this.overlayImg.complete){a.drawImage(this.overlayImg,0,0)}}catch(c){if(console.error){console.error("error fadeOut on "+this.overlayImg.src+" : "+c.name+" "+c.message)}}}a.restore();clearInterval(b);a.globalAlpha=1}return true},initializeImages:function(){var b=this.canvas;var c=this.context;if(!this.img){var a=b.childElements()[0];if(!a){a=new Image();a.onload=function(){this.canvas.width=a.width;this.canvas.height=a.height;this.hypotenuse=Math.sqrt(b.width*b.width+b.height*b.height)}.bind(this);a.src=this.imgSrc}else{this.canvas.width=a.width;this.canvas.height=a.height;this.hypotenuse=Math.sqrt(b.width*b.width+b.height*b.height)}this.img=a;b.style.background="url("+this.img.src+") no-repeat"}if(!this.overlayImg){var f=b.childElements()[1];if(!f){f=new Image();f.onload=function(){c.fillStyle="rgba(255,255,255,0.4)";c.fillRect(0,0,b.width,b.height);c.drawImage(f,0,0)};f.src=this.overlayURL}else{c.fillStyle="rgba(255,255,255,0.4)";c.fillRect(0,0,b.width,b.height);try{if(f.complete){c.drawImage(f,0,0)}}catch(d){if(console.error){console.error(d.name+" "+d.message)}}}this.overlayImg=f}},drawImage:function(d){var b=this.canvas;var c=this.context;c.save();c.clearRect(0,0,b.width,b.height);var a=d?d:this.radius;if((this.x||this.old_x)&&(this.y||this.old_y)){c.beginPath();c.arc(this.x||this.old_x,this.y||this.old_y,a,0,Math.PI*2,false);c.clip()}c.fillStyle="rgba(255,255,255,0.4)";c.fillRect(0,0,b.width,b.height);try{if(this.overlayImg.complete){c.drawImage(this.overlayImg,0,0)}}catch(f){if(console.error){console.error(f.name+" "+f.message)}}c.restore()},move:function(){var c=this.old_x;var i=this.old_y;var b=this.radius;var a=this.x;var h=this.y;var d=this.r;var g=this.gradient;this.drawImage();context=this.context;context.save();context.beginPath();context.globalCompositeOperation="destination-out";context.fillStyle=g;try{context.translate(a||c,h||i)}catch(f){if(console.error){console.error("error trying to translate to "+a+", "+h)}}context.arc(0,0,b,0,2*Math.PI,false);context.closePath();context.fill();context.restore();this.old_x=a;this.old_y=h;this.r=d}});